---
import { Image } from "astro:assets";
import heroBg from "../assets/hero-background.png";
import TypewriterText from "./TypewriterText";
import HeroStats from "./HeroStats";
import TechStack from "./TechStack.astro";
---

<section
    class="relative min-h-screen flex items-center justify-center overflow-hidden bg-brand-dark"
>
    <!-- Background Image with Overlay -->
    <div class="absolute inset-0 z-0 opacity-20">
        <Image
            src={heroBg}
            alt="Cyber Industrial Background"
            class="w-full h-full object-cover"
            loading="eager"
            fetchpriority="high"
        />
        <div
            class="absolute inset-0 bg-gradient-to-b from-brand-dark via-transparent to-brand-dark"
        >
        </div>
    </div>

    <!-- Terminal Window -->
    <h1 class="sr-only">Empower Automation - Google Workspace Specialist</h1>
    <div class="relative z-10 w-full max-w-4xl mx-4">
        <div
            class="bg-[#0d1117]/90 backdrop-blur-md border border-gray-700 rounded-lg shadow-2xl overflow-hidden"
        >
            <!-- Terminal Header -->
            <div
                class="bg-gray-800/50 px-4 py-2 flex items-center gap-2 border-b border-gray-700"
            >
                <div class="w-3 h-3 rounded-full bg-red-500"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
                <span class="ml-2 text-xs text-gray-400 font-mono"
                    >empower-automation -- bash -- 80x24</span
                >
            </div>

            <!-- Terminal Content -->
            <div class="p-6 md:p-10 font-mono text-left">
                <div class="mb-4 text-gray-400">
                    <span class="text-brand-gold">user@empower</span>:<span
                        class="text-blue-400">~</span
                    >$ ./system_scan.sh
                </div>

                <div class="space-y-4">
                    <div id="terminal-status-line" class="text-green-400">
                        > DETECTING INEFFICIENCIES...
                    </div>
                    <div id="terminal-output-block" class="text-gray-300 pl-4">
                        [!] Found: 15 hours of manual data entry/week<br />
                        [!] Found: High risk of human error<br />
                        [!] Found: Disconnected systems
                    </div>

                    <div class="mt-6 text-gray-400">
                        <span class="text-brand-gold">user@empower</span>:<span
                            class="text-blue-400">~</span
                        >$ ./execute_solution.js
                    </div>

                    <div class="min-h-[3rem] md:min-h-[4rem]">
                        <TypewriterText
                            client:visible
                            text="Stop Doing Repetitive Tasks Manually."
                            className="text-2xl md:text-4xl font-bold text-white mt-2 block"
                            delay={1.5}
                        />
                    </div>

                    <div
                        class="mt-8 flex flex-wrap gap-4 opacity-0 animate-fade-in"
                        style="animation-delay: 4s; animation-fill-mode: forwards;"
                    >
                        <a
                            href="#services"
                            class="bg-brand-orange hover:bg-orange-600 text-white font-bold py-3 px-6 rounded transition-colors"
                        >
                            See What I Build
                        </a>
                        <a
                            href="/contact"
                            class="border border-brand-orange text-brand-orange hover:bg-brand-orange/10 font-bold py-3 px-6 rounded transition-colors"
                        >
                            Book Consultation
                        </a>
                    </div>

                    <div
                        class="opacity-0 animate-fade-in"
                        style="animation-delay: 4.5s; animation-fill-mode: forwards;"
                    >
                        <HeroStats client:load />
                    </div>
                    <div
                        class="opacity-0 animate-fade-in"
                        style="animation-delay: 5s; animation-fill-mode: forwards;"
                    >
                        <TechStack />
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    // MAGIC WELCOME LOGIC
    document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        const name = urlParams.get("name");
        const company = urlParams.get("company");

        if (name) {
            const statusLine = document.getElementById("terminal-status-line");
            const outputBlock = document.getElementById(
                "terminal-output-block",
            );

            if (statusLine && outputBlock) {
                // Typewriter effect simulation for the status line
                statusLine.innerHTML = "> CONNECTING...";

                setTimeout(() => {
                    statusLine.innerHTML = `> DETECTING VISITOR... [====================] 100%`;
                    statusLine.classList.add("text-brand-gold");

                    // Rewriting the output block
                    let content = `> WELCOME, <span class="text-brand-orange font-bold">${name.toUpperCase()}</span>.<br/>`;
                    if (company) {
                        content += `> TARGET SYSTEM: <span class="text-blue-400">${company.toUpperCase()} OPERATIONS</span>.<br/>`;
                    }
                    content += `> STATUS: <span class="text-green-500 font-bold">READY TO OPTIMISE</span>.`;

                    outputBlock.innerHTML = content;
                    outputBlock.classList.remove("text-gray-300");
                    outputBlock.classList.add("text-white", "leading-loose");
                }, 800);
            }
        }
    });
</script>

<style>
    @keyframes fade-in {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    .animate-fade-in {
        animation: fade-in 0.5s ease-out;
    }
</style>
